# ECK WMS Routing Rules
# Generated by Architect AI

# 1. Exact match for "e" -> Redirect to /E/
# Safe: Does NOT match "elena.txt" because of exact match (=)
location = /e {
    return 301 /E/;
}

# 2. Exact match for "E" -> Redirect to /E/
location = /E {
    return 301 /E/;
}

# 3. Case correction for directory start -> Redirect to /E/...
# Safe: Does NOT match "elena.txt" because of trailing slash in match
location ^~ /e/ {
    rewrite ^/e/(.*) /E/$1 permanent;
}

# 4. Main Application
location ^~ /E/ {
    # Backend expects /E prefix (HTTP_PATH_PREFIX=/E)
    proxy_pass http://127.0.0.1:3210;

    proxy_http_version 1.1;
    proxy_set_header Upgrade $http_upgrade;
    proxy_set_header Connection "upgrade";
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;

    # Timeouts for long-running sync operations
    proxy_read_timeout 300s;
    proxy_connect_timeout 75s;
}
